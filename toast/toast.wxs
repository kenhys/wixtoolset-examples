<?xml version="1.0" encoding="utf-8"?>
<!--
    # This comment is generated by WixEdit, the specific commandline
    # arguments for the WiX Toolset are stored here.

    candleArgs: 
    lightArgs: "<projectname>.wixobj" -out "<projectname>.msi" <extensions> -ext WixUIExtension
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Product Id="acc98d08-ffda-4470-bfa4-b0c85e52a320" Name="BatchTest" Language="1033" Version="0.0.0.1" Manufacturer="WixEdit" UpgradeCode="6df5bed9-0319-4015-b0ea-6722ca52934b">
    <Package
        Description="Test toast in a Product"
        Comments="Toast test"
        InstallerVersion="200"
        InstallPrivileges="elevated"
        InstallScope="perMachine"
        Compressed="yes" />
    <Media Id="1" Cabinet="simple.cab" EmbedCab="yes" />
    <SetDirectory Id="WINDOWSVOLUME" Value="[WindowsVolume]" />
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="WINDOWSVOLUME">
        <Directory Id="OPTLOCATION" Name="opt">
          <Directory Id="PROJECTLOCATION" Name="toast">
            <Directory Id="BINLOCATION" Name="bin">
              <Component Id="TraverseAcl" Guid="3cff09f6-9abd-4879-9de2-948770e3a725">
                <CreateFolder>
                  <PermissionEx Sddl="D:(A;OICI;0x1200a9;;;BU)(A;OICI;FA;;;BA)(A;OICI;FA;;;S-1-5-80-956008885-3418522649-1831038044-1853292631-2271478464)(A;OICI;FA;;;CO)(A;OICI;FA;;;SY)"/>
                </CreateFolder>
              </Component>
            </Directory>
            <Directory Id="SHARELOCATION" Name="share">
              <Component Id="TraverseAcl2" Guid="4720d060-be40-454f-a52c-1e35b469fc05">
                <CreateFolder>
                  <PermissionEx Sddl="D:(A;OICI;0x1200a9;;;BU)(A;OICI;FA;;;BA)(A;OICI;FA;;;S-1-5-80-956008885-3418522649-1831038044-1853292631-2271478464)(A;OICI;FA;;;CO)(A;OICI;FA;;;SY)"/>
                </CreateFolder>
              </Component>
            </Directory>
          </Directory>
        </Directory>
      </Directory>
    </Directory>

    <DirectoryRef Id="BINLOCATION">
      <Component Id="PostToastBat"
                 Guid="d0aec3d0-bd39-4ea7-a8a5-5c5d63b357ea">
        <File Name="fluent-package-post-toast.bat"
              KeyPath="yes"
              Source="fluent-package-post-toast.bat" />
      </Component>
      <Component Id="PostToastPs"
                 Guid="431c2252-13e2-47de-b15c-b69bebfd84d8">
        <File Name="fluent-package-post-toast.ps1"
              KeyPath="yes"
              Source="fluent-package-post-toast.ps1" />
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="SHARELOCATION">
      <Component Id="PostToastIcon"
                 Guid="d44dc5ff-ddbb-406d-9590-661b49d284a2">
        <File Name="fluent-package-toast-icon.png"
              KeyPath="yes"
              Source="fluent-package-toast-icon.png" />
      </Component>
    </DirectoryRef>

    <Feature Id="DefaultFeature" Title="Main Feature" Level="1">
      <ComponentRef Id="PostToastBat" />
      <ComponentRef Id="PostToastPs" />
      <ComponentRef Id="PostToastIcon" />
      <ComponentRef Id="TraverseAcl" />
      <ComponentRef Id="TraverseAcl2" />
    </Feature>

    <Property Id="PostNotifyWithToastBat" Value=" "/>
    <CustomAction Id="SetPostNotifyWithToastBat"
                  Property="PostNotifyWithToastBat"
                  Value="&quot;[PROJECTLOCATION]bin\fluent-package-post-toast.bat&quot;"/>
    <CustomAction Id="PostNotifyWithToastBat"
                  BinaryKey="WixCA"
                  DllEntry="WixQuietExec64"
                  Execute="deferred"
                  Return="check"
                  Impersonate="no" />

    <InstallExecuteSequence>
      <!-- Notify enterprise services for Fluentd users -->
      <Custom Action="SetPostNotifyWithToastBat" Before="InstallFinalize">NOT Installed</Custom>
      <Custom Action="PostNotifyWithToastBat" After="SetPostNotifyWithToastBat">NOT Installed</Custom>
    </InstallExecuteSequence>
    <UI />
  </Product>
</Wix>
